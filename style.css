button { pointer-events: auto; }
:root {
    --primary: #ff6b81; --secondary: #1e90ff; --accent: #feca57;
    --bg-sky: #48dbfb; --grass: #55efc4; 
    --panel: #ffffff; --text: #2f3542;
    --wood: #e67e22; --wall: #f1c40f;
    --perfect: #00b894; --good: #0984e3; --bad: #fdcb6e; --miss: #d63031;
    --game-ratio: 16 / 9;
}
.nav-arrow {
    display: none;
}
* { box-sizing: border-box; }
body {
    font-family: 'Press Start 2P', cursive;
    background-color: #000; 
    background-image: none; 
    margin: 0; 
    padding: 0;
    overflow: hidden; 
    width: 100vw;
    height: 100vh;
    user-select: none;
    touch-action: none; 
}

#game-container {
    width: 100%;
    height: 100%;
    
    max-width: none;
    max-height: none;
    
    background: var(--panel);
    border: none;
    border-radius: 0;
    
    position: absolute; 
    top: 0;
    left: 0;
    
    display: flex;
    flex-direction: column;
    box-shadow: none;
}

.screen {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--panel); display: none;
    flex-direction: column; align-items: center; justify-content: center;
    z-index: 10;
}

.screen.active { display: flex; }
h1, h2 { color: var(--primary); text-shadow: 2px 2px 0 #ffeaa7; text-align: center; margin-bottom: 15px; line-height: 1.5; font-size: 18px; }
button {
    background: #fff; border: 3px solid #2f3542; padding: 10px 12px;
    color: #2f3542; font-family: 'Press Start 2P', cursive; font-size: 10px;
    cursor: pointer; margin: 5px; box-shadow: 4px 4px 0 #2f3542;
    transition: transform 0.1s; border-radius: 4px;
}
button:hover { transform: translate(-2px, -2px); background: var(--accent); color: #fff; }
button:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #2f3542; }

/* TITLE SCREEN */
#title-screen {
    background-color: var(--bg-sky);
    background-image: repeating-linear-gradient(45deg, #48dbfb 25%, #4bcffa 25%, #4bcffa 50%, #48dbfb 50%, #48dbfb 75%, #4bcffa 75%, #4bcffa 100%);
    background-size: 20px 20px;
}
.title-logo {
    font-size: 40px; color: #fff; text-shadow: 4px 4px 0 var(--primary), 8px 8px 0 #000;
    margin-bottom: 50px; text-align: center; line-height: 1.5;
}

/* CREATION SCREEN */
#create-box {
    background: #fff; 
    border: 4px solid #2f3542; 
    padding: 15px;
    border-radius: 10px; 
    display: flex; 
    flex-direction: column; 
    align-items: center;
    width: 95%; 
    max-width: 800px; /* TÄƒng chiá»u rá»™ng Ä‘á»ƒ dÃ n hÃ ng ngang */
    max-height: 95vh; 
    overflow-y: auto;
}

/* DÃ n hÃ ng ngang cho PC vÃ  Mobile Landscape */
.creation-cols { 
    display: flex; 
    gap: 15px; 
    width: 100%; 
    justify-content: center; 
    flex-wrap: nowrap; /* Æ¯u tiÃªn náº±m ngang */
}
.creation-left { flex: 1.2; }
.creation-right { 
    flex: 1; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
}
#stats-inputs { display: flex; flex-direction: column; gap: 8px; width: 100%; margin: 10px 0; }
.stat-row {
    display: flex; justify-content: space-between; align-items: center;
    background: #f1f2f6; padding: 5px 10px; border: 2px solid #dfe4ea; border-radius: 4px;
    font-size: 10px; height: 40px;
}
.stat-controls {
    display: flex; align-items: center; gap: 8px; min-width: 80px; justify-content: flex-end;
}
.stat-controls button {
    width: 24px; height: 24px; padding: 0; display: flex; justify-content: center; align-items: center; flex-shrink: 0; margin: 0;
}
.stat-val { min-width: 25px; text-align: center; font-weight: bold; }
                        
/* Character Preview */
#char-preview { 
    width: 140px; 
    height: 140px; 
    border: 3px solid #2f3542; 
    background: #fff; 
    margin-bottom: 8px; 
    image-rendering: pixelated; 
}
.color-picker-row { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; justify-content: center; }
.color-btn { width: 20px; height: 20px; border: 2px solid #fff; box-shadow: 2px 2px 0 #000; cursor: pointer; }
.color-btn:hover { transform: scale(1.1); }
.color-label { font-size: 8px; margin-bottom: 5px; color: #555; }

/* MAP UI */
#hub-ui-overlay { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
#hub-stats-display {
    position: absolute; top: 20px; right: 20px;
    background: rgba(255, 255, 255, 0.95);
    padding: 15px 20px;
    border: 4px solid #2f3542; 
    border-radius: 12px;
    font-size: 14px;
    text-align: right; 
    pointer-events: auto;
    line-height: 1.8;
    box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
    min-width: 180px;
}

#room-notification, #interaction-modal {
    position: absolute; left: 50%; transform: translateX(-50%);
    background: #fff; border: 4px solid #2f3542; padding: 15px;
    text-align: center; pointer-events: auto; z-index: 20;
    box-shadow: 6px 6px 0 rgba(0,0,0,0.2); border-radius: 8px;
}

#room-notification { top: 40%; width: 300px; }

#interaction-modal {
    /* Vá»‹ trÃ­ cá»‘ Ä‘á»‹nh */
    position: fixed;
    bottom: 5%; /* NhÃ­ch lÃªn cao má»™t chÃºt cho dá»… nhÃ¬n */
    left: 50%;
    transform: translateX(-50%);
    
    /* KÃ­ch thÆ°á»›c TO vÃ  CAO hÆ¡n */
    width: 92%;
    max-width: 650px;
    min-height: 120px; /* Ã‰p chiá»u cao tá»‘i thiá»ƒu lá»›n háº³n */
    
    /* Giao diá»‡n */
    background: #fff;
    border: 6px solid #2f3542; /* Viá»n dÃ y chuáº©n Pixel */
    border-radius: 4px; /* Bo gÃ³c Ã­t thÃ´i cho nÃ³ vuÃ´ng vá»©c */
    padding: 30px; /* Äá»‡m thoÃ¡ng bÃªn trong */
    box-shadow: 0 10px 0 rgba(0,0,0,0.5); /* BÃ³ng Ä‘á»• khá»‘i máº¡nh máº½ */
    
    /* Bá»‘ cá»¥c */
    display: none;
    flex-direction: column;
    z-index: 20000;
}

/* TÃªn NPC */
#dialogue-npc-name {
    color: #ff4757;
    /* Sá»¬ Dá»¤NG FONT PIXEL */
    font-family: 'Press Start 2P', cursive;
    font-size: 20px !important; /* Cá»¡ chá»¯ vá»«a pháº£i vá»›i font nÃ y */
    line-height: 1.5;
    margin-bottom: 25px;
    text-shadow: 2px 2px 0 #2f3542;
    text-transform: uppercase;
}

/* Ná»™i dung há»™i thoáº¡i */
#dialogue-text {
    color: #2f3542;
    /* Sá»¬ Dá»¤NG FONT PIXEL */
    font-family: 'VT323';
    font-size: 30px !important; /* Font pixel nÃ y khÃ¡ to nÃªn 14px lÃ  dá»… Ä‘á»c */
    line-height: 2.05 !important; /* GiÃ£n dÃ²ng rá»™ng ra */
    margin-bottom: 40px !important; /* Äáº©y cÃ¡c nÃºt báº¥m ra xa */
    flex-grow: 1; /* Chiáº¿m khoáº£ng trá»‘ng */
}

/* Container chá»©a nÃºt */
#dialogue-options {
    display: flex;
    flex-direction: column;
    gap: 15px; /* Khoáº£ng cÃ¡ch giá»¯a cÃ¡c nÃºt */
}

/* NÃºt lá»±a chá»n */
.dialogue-btn {
    background: #f1f2f6;
    border: 4px solid #2f3542;
    border-radius: 4px;
    padding: 15px 10px; /* NÃºt cao, dá»… báº¥m */
    
    /* Font chá»¯ nÃºt */
    font-family: 'Press Start 2P', cursive;
    font-size: 12px; /* Cá»¡ chá»¯ nÃºt nhá» hÆ¡n má»™t chÃºt */
    color: #2f3542;
    text-align: center;
    text-transform: uppercase; /* NÃºt nÃªn viáº¿t hoa háº¿t */
    
    box-shadow: 0 6px 0 #bdc3c7; /* BÃ³ng nÃºt */
    transition: all 0.1s;
    cursor: pointer;
}

/* Hiá»‡u á»©ng báº¥m nÃºt */
.dialogue-btn:active {
    transform: translateY(6px); /* NÃºt lÃºn xuá»‘ng tháº­t */
    box-shadow: none;
    background: #ffeaa7;
    border-color: #e67e22;
}

#final-team-score-list {
    flex-grow: 1;
    overflow-y: auto;
    min-height: 200px;
}

/* TEAM SELECT */
#team-select-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.95); 
    display: none; flex-direction: column; align-items: center; justify-content: center;
    z-index: 50; pointer-events: auto;
}
.team-slot {
    width: 140px; height: 180px; border: 3px dashed #ccc; margin: 10px;
    display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
    background: #fff; transition: all 0.3s; border-radius: 10px;
    box-shadow: 5px 5px 0 #eee;
}
.team-slot.filled { border: 3px solid var(--primary); transform: scale(1.05); }

/* MINIGAME */
#minigame-screen { background: #2d3436; }
#minigame-canvas-container {
    width: 80% !important;
    height: 80vh !important; 
    max-width: 800px;
    max-height: 500px;
    margin: 0 auto;
    position: relative;
    border: 4px solid #fff;
    background: #000;
}

#minigame-result-overlay {
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.9); display: none;
    flex-direction: column; align-items: center; justify-content: center; color: #fff; z-index: 30;
}
        
/* Dance Game Styles Updated */
.dance-game-container {
    display: flex; flex-direction: column; justify-content: space-between; height: 100%; width: 100%; padding: 40px 0;
}
.dance-btn {
    width: 70px; height: 70px; margin: 0 10px; border: 4px solid #fff;
    background: #333; color: #fff; font-size: 24px;
    display: inline-flex; justify-content: center; align-items: center;
    font-family: 'Press Start 2P', cursive; cursor: pointer;
    text-shadow: 2px 2px 0 #000;
    border-radius: 10px;
    box-shadow: 0 5px 0 #000;
}
.dance-btn.active {
    border-color: #fff; background: #00b894;
    transform: translateY(4px); box-shadow: 0 1px 0 #000;
}
.dance-btn#db-0 { background: #ff7675; } 
.dance-btn#db-1 { background: #74b9ff; } 
.dance-btn#db-2 { background: #ffeaa7; color:#333; }
.dance-btn#db-3 { background: #a29bfe; } 

/* Rap Game Styles */
#rap-game-ui { text-align: center; width: 100%; color: #fff; display: flex; flex-direction: column; align-items: center; }
#rap-timer-bar { width: 300px; height: 20px; background: #555; margin: 20px auto; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
#rap-timer-fill { height: 100%; width: 100%; background: #ff4757; transition: width 0.1s linear; }

/* STAGE */
.concept-btn { width: 60px; font-size: 8px; background: #fff; border: 2px solid #555; }
.concept-btn.selected { background: var(--accent); color: #fff; border-color: var(--primary); transform: scale(1.1); }  
#stage-ui { display: flex; width: 100%; height: 100%; background: #2c2c54; justify-content: center; } 
.side-panel { width: 180px; background: #f1f2f6; border-right: 4px solid #2f3542; color: #2f3542; padding: 10px; display: flex; flex-direction: column; }
#main-stage { width: 500px; background: #191936; position: relative; border-left: 4px solid #2f3542; border-right: 4px solid #2f3542; } 

canvas {
    display: block;
    width: 100%;
    height: 100%;
}
        
#score-hud { position: absolute; top: 20px; width: 100%; text-align: center; color: #fff; font-size: 20px; text-shadow: 2px 2px 0 var(--primary); pointer-events: none; }
#combo-hud { position: absolute; top: 50px; width: 100%; text-align: center; color: var(--accent); font-size: 14px; pointer-events: none; }

/* RESULTS */
#result-screen .result-box {
    background: #74b9ff; padding: 20px; border: 4px solid #2f3542; border-radius: 15px;
    width: 90%; height: 70vh; overflow-y: auto;
}

#ranking-list {
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); /* Nới rộng cột ra một chút cho thoáng */
    gap: 15px;
    padding: 10px;
}

#ranking-list .rank-card > div:first-child {
    font-size: 18px !important;    
    font-weight: bold !important;  
    color: #2f3542 !important;     
    margin-bottom: 4px !important;       
    text-shadow: 1px 1px 0px #fff; 
    line-height: 1 !important;           
    
    text-align: center !important;
    width: 100% !important;         /* Ã‰p khung rá»™ng ra háº¿t cá»¡ thÃ¬ má»›i cÄƒn giá»¯a Ä‘Æ°á»£c */
    display: block !important;      /* Äáº£m báº£o nÃ³ lÃ  dáº¡ng khá»‘i Ä‘á»ƒ nháº­n width 100% */
}

.rank-card {
    background: #fff;
    border: 3px solid #2f3542;
    border-radius: 8px;
    text-align: center;
    position: relative; 
    box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
    height: 180px;
    width:135px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
#ranking-list .rank-card > div:first-child span {
    font-size: 13px !important; 
    font-weight: 900 !important;
    padding-top: 2px;
}

.rank-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
}
.rank-card.player { background: #ffeaa7; border-color: var(--primary); border-width: 3px; }
.rank-card.eliminated { background: #b2bec3; opacity: 0.7; filter: grayscale(100%); }
        
/* --- LƯỚI DANH SÁCH TRAINEE (CHỐNG ÉP THẺ, TỰ ĐỘNG XUỐNG DÒNG) --- */
#npc-list-grid {
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important; /* Căn giữa toàn bộ danh sách */
    gap: 20px !important;
    padding: 20px !important;
    overflow-y: auto !important;
    height: 100% !important;
}

#npc-list-grid > div {
    flex: 0 0 auto !important; /* KHÔNG CHO PHÉP thẻ tự động co nhỏ lại */
    width: 180px !important;   /* Chiều rộng cố định to, rõ ràng */
    min-height: 220px !important; 
    
    background: #fff;
    border: 3px solid #2f3542;
    border-radius: 12px;
    box-shadow: 4px 6px 0 rgba(0,0,0,0.1);
    
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 15px 10px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
}

#npc-list-grid > div:hover {
    transform: translateY(-5px);
    box-shadow: 6px 8px 0 rgba(0,0,0,0.15);
    border-color: #74b9ff;
}

/* Tên Trainee */
#npc-list-grid > div > div:nth-child(2) {
    font-size: 20px !important;
    font-weight: 900 !important;
    margin-bottom: 8px !important;
    color: #192a56 !important;
}

/* Chỉ số bên dưới */
#npc-list-grid > div > div:last-child {
    font-size: 12px !important;
    line-height: 1.5 !important;
    color: #2f3542 !important;
}

#bgm-toggle { position: absolute; top: 10px; left: 10px; z-index: 100; font-size: 8px; padding: 5px; }

.stats-overlay {
    position: absolute;
    bottom: -100%;
    left: 0;
    width: 100%;
    height: auto;
    background: rgba(47, 53, 66, 0.95);
    color: #fff;
    padding: 10px 5px;
    transition: bottom 0.3s ease-in-out;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 5px;
    font-size: 8px;
}
.rank-card:hover .stats-overlay { bottom: 0; }
        
/* Overlays */
#stage-detail-overlay, #stage-fail-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95); display: none;
    flex-direction: column; align-items: center; justify-content: center;
    z-index: 60; pointer-events: auto;
}
        
.score-box {
    background: #fff; border: 4px solid #2f3542; padding: 20px; border-radius: 15px;
    width: 400px; text-align: left; color: #2f3542;
    box-shadow: 10px 10px 0 var(--accent);
}
.score-line { display: flex; justify-content: space-between; margin: 10px 0; border-bottom: 2px dotted #ccc; padding-bottom: 5px; }
.total-line { font-size: 20px; color: var(--primary); font-weight: bold; text-align: center; margin-top: 20px; border: none; }

/* relationship */
#rel-list-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    overflow-y: auto;
    flex-grow: 1;
    padding: 10px;
    width: 100%;
}
.rel-card {
    background: #fff;
    border: 3px solid #ff9ff3;
    border-radius: 10px;
    padding: 5px;
    text-align: center;
    height: 140px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
}
.rel-score {
    font-size: 14px;
    font-weight: bold;
    color: #ff4757;
    margin: 5px 0;
}
.rel-status {
    font-size: 8px;
    background: #2f3542;
    color: #fff;
    padding: 3px 6px;
    border-radius: 4px;
}

/* win screen - PYRAMID STYLES */
#pyramid-container {
    display: flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 30px;
}
.py-row {
    display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; align-items: flex-end;
}
.debut-card {
    width: 70px; height: 90px; background: #fff; border: 3px solid #2f3542; border-radius: 8px;
    position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;
    box-shadow: 4px 4px 0 rgba(0,0,0,0.1); transition: transform 0.3s;
}
.debut-avatar { width: 30px; height: 30px; margin-bottom: 5px; border: 2px solid #eee; }
.debut-badge {
    position: absolute; top: -10px; left: -10px; width: 20px; height: 20px;
    background: #ff4757; color: #fff; border-radius: 50%;
    font-size: 8px; font-weight: bold; display: flex; align-items: center; justify-content: center;
    border: 2px solid #fff; z-index: 2;
}
/* TOP 1 */
.debut-card.rank-1 {
    width: 100px; height: 130px; border-color: #ffd700; background: linear-gradient(to bottom, #fff, #fff5c4);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); z-index: 10; transform: scale(1.1);
}
.debut-card.rank-1 .debut-avatar { width: 50px; height: 50px; }
.debut-card.rank-1 .debut-badge { background: #ffd700; color: #2f3542; width: 25px; height: 25px; font-size: 12px; }
/* TOP 2 & 3 */
.debut-card.rank-2, .debut-card.rank-3 {
    width: 85px; height: 110px; border-color: #a4b0be; z-index: 5;
}
.debut-card.rank-3 { border-color: #cd7f32; }
.debut-card.rank-2 .debut-avatar, .debut-card.rank-3 .debut-avatar { width: 40px; height: 40px; }
.debut-card.rank-normal { opacity: 0.9; }

/* Notification */
.toast-visible { top: 30px !important; opacity: 1 !important; }
.toast-hidden { top: 0px !important; opacity: 0 !important; }

#draft-visual {
    position: relative;
    width: 95%;           /* Chiáº¿m 95% chiá»u rá»™ng cha */
    height: 70% !important;        /* Cá» Äá»ŠNH CHIá»€U CAO (Quan trá»ng) */
    background: #fff9c4;  
    border: 4px solid #2f3542;
    border-radius: 12px;
    margin: 10px auto;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
    display: block;       /* Äáº£m báº£o nÃ³ lÃ  block */
}

#draftCanvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* Style cho thanh Ä‘iá»ƒm Team */
.team-score-bar {
    display: flex;
    align-items: center;
    background: #333;
    height: 50px;
    border-radius: 8px;
    overflow: hidden;
    border: 2px solid #555;
    position: relative;
    opacity: 0; /* áº¨n lÃºc Ä‘áº§u Ä‘á»ƒ animation */
    transition: opacity 0.5s;
}

.team-score-bar.revealed {
    opacity: 1;
}

.ts-rank {
    width: 50px;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
    background: #444;
    height: 100%;
    display: flex; align-items: center; justify-content: center;
}

.ts-name {
    flex-grow: 1;
    padding-left: 15px;
    font-size: 10px;
    z-index: 2;
}

.ts-val {
    width: 120px;
    text-align: right;
    padding-right: 15px;
    font-weight: bold;
    font-size: 12px;
    color: #feca57;
    z-index: 2;
}

/* Thanh progress cháº¡y ná»n */
.ts-fill {
    position: absolute;
    top: 0; left: 0;
    height: 100%;
    background: linear-gradient(90deg, rgba(255,255,255,0.1), rgba(255,255,255,0.3));
    width: 0%;
    transition: width 2s cubic-bezier(0.22, 1, 0.36, 1); /* Hiá»‡u á»©ng cháº¡y cháº­m dáº§n */
    z-index: 1;
}

/* Highlight Ä‘á»™i ngÆ°á»i chÆ¡i */
.team-score-bar.my-team {
    border-color: #feca57;
    box-shadow: 0 0 10px rgba(254, 202, 87, 0.3);
}
.team-score-bar.my-team .ts-rank { background: #feca57; color: #222; }

.result-box, #create-box {
    max-height: 80% !important;
    width: 90% !important;
    overflow-y: auto;
}

#rotate-device-overlay {
    display: none; /* Máº·c Ä‘á»‹nh áº©n */
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #2f3542; z-index: 9999;
    flex-direction: column; align-items: center; justify-content: center;
    color: #fff;
}
.rotate-icon { font-size: 50px; margin-bottom: 20px; animation: spin 2s infinite linear; }

@keyframes spin { 100% { transform: rotate(360deg); } }

/* 1. Máº·c Ä‘á»‹nh lÃ  Ä‘á»ƒ JS tá»± quyáº¿t Ä‘á»‹nh (khÃ´ng Ã©p !important) */
#interaction-modal {
    display: none; /* Máº·c Ä‘á»‹nh áº©n */
}

/* 2. Chá»‰ khi JS báº­t nÃ³ lÃªn (thÃªm style="display: block"), ta má»›i Ã©p nÃ³ thÃ nh flex */
#interaction-modal[style*="display: block"] {
    display: flex !important;
    flex-direction: column !important;
}

/* ===== MOBILE: MỘT PHIÊN BẢN DUY NHẤT - LAYOUT NGANG ===== */
@media (max-width: 1024px) {
    #mobile-controls {
        display: none !important;  /* Máº·c Ä‘á»‹nh áº©n */
    }

    #joystick-base {
        width: 120px;
        height: 120px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        position: relative;
        backdrop-filter: blur(4px);
    }

    #joystick-stick {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        margin-top: -25px; margin-left: -25px; /* CÄƒn giá»¯a thá»§ cÃ´ng */
        pointer-events: none; /* Äá»ƒ cáº£m á»©ng xuyÃªn qua nÃºm vÃ o Ä‘áº¿ */
    }
    /* 1. Thu nhá» cÃ¡c nÃºt báº¥m chÃ­nh (Relations, Settings) */
    button {
        padding: 4px 8px !important;
        font-size: 8px !important;
        border-width: 2px !important;
        box-shadow: 2px 2px 0 #2f3542 !important;
        margin: 2px !important;
    }

    button[onclick="Game.showRelList()"] {
        width: 100px !important;
        top: 10px !important;
        left: 10px !important;
    }

    button[onclick="Game.toggleSettings()"] {
        width: 100px !important;
        top: 40px !important; /* KÃ©o lÃªn sÃ¡t nÃºt trÃªn */
        left: 10px !important;
    }

    /* 2. Thu nhá» báº£ng chá»‰ sá»‘ (Stats) bÃªn pháº£i */
    #hub-stats-display {
        top: 5px !important;
        right: 5px !important;
        padding: 5px 8px !important;
        font-size: 8px !important; /* Chá»¯ siÃªu nhá» */
        line-height: 1.4 !important;
        width: 110px !important; /* Cá»‘ Ä‘á»‹nh chiá»u rá»™ng nhá» */
        min-width: auto !important;
        border-width: 2px !important;
    }
    
    #hub-stats-display hr {
        margin: 2px 0 !important;
    }

    #create-box {
        width: 70% !important; /* Äá»«ng Ä‘á»ƒ quÃ¡ rá»™ng */
        max-height: 95vh !important; /* Gáº§n full chiá»u cao */
        padding: 10px !important;
        display: flex;
        flex-direction: row; /* DÃ n ngang thay vÃ¬ dá»c Ä‘á»ƒ tiáº¿t kiá»‡m chiá»u cao */
        flex-wrap: wrap;
        justify-content: center;
        align-items: flex-start;
    }

    #create-box h1 {
        width: 100%;
        font-size: 12px !important;
        margin: 5px 0 !important;
        text-align: center;
    }

    .creation-cols {
        gap: 10px !important;
    }

    /* Thu nhá» cÃ¡c dÃ²ng chá»‰ sá»‘ cá»™ng Ä‘iá»ƒm */
    .stat-row {
        height: 24px !important;
        font-size: 8px !important;
        padding: 2px 5px !important;
    }
    
    .stat-controls button {
        width: 18px !important;
        height: 18px !important;
        font-size: 8px !important;
        padding: 0 !important;
    }

    /* Thu nhá» áº£nh nhÃ¢n váº­t preview */
    #char-preview {
        width: 60px !important;
        height: 60px !important;
        border-width: 2px !important;
    }
    
    .color-label { font-size: 6px !important; margin-bottom: 2px !important; }
    
    #npc-intro-screen > div {
        width: 98% !important; 
        height: 98% !important;
        padding: 5px !important;
        display: flex !important;
        flex-direction: column !important;
    }

    #npc-intro-screen h2 {
        font-size: 14px !important; /* TÄƒng nháº¹ tiÃªu Ä‘á» 30 TRAINEES */
        margin: 5px 0 !important;
    }

    /* 2. LÆ°á»›i hiá»ƒn thá»‹ (Grid): TÄƒng kÃ­ch thÆ°á»›c cá»™t Ä‘á»ƒ tháº» to hÆ¡n */
    #npc-list-grid {
        display: grid !important;
        /* Ã‰p Ä‘Ãºng 5 cá»™t má»—i dÃ²ng */
        grid-template-columns: repeat(5, 1fr) !important; 
        gap: 5px !important;
        padding: 5px !important;
        overflow-y: auto !important; 
    }

    /* 2. LÆ°á»›i hiá»ƒn thá»‹ Ranking (image_c8f27d.png) */
    /* Giáº£ sá»­ id container cá»§a báº£ng xáº¿p háº¡ng lÃ  #ranking-grid hoáº·c tÆ°Æ¡ng Ä‘Æ°Æ¡ng */
    #ranking-list {
        display: grid !important;
        grid-template-columns: repeat(5, 1fr) !important; /* Hiá»‡n táº¡i Ä‘ang lÃ  4, Ä‘á»•i thÃ nh 5 */
        gap: 5px !important;
        padding: 10px !important;
    }

    /* 3. Tháº» NhÃ¢n Váº­t (Rank Card): PhÃ³ng to layout */
    .rank-card {
        height: auto !important;
        min-height: 140px !important; /* TÄƒng tá»« 90px Ä‘á»ƒ chá»©a Ä‘á»§ text chá»‰ sá»‘ */
        width: auto !important;
        padding: 6px !important;
        border-width: 2px !important; /* Viá»n dÃ y hÆ¡n cho rÃµ pixel art */
        display: flex !important;
        flex-direction: column !important;
        justify-content: space-between !important;
    }

    /* PhÃ³ng to Avatar NPC */
    .rank-card > div:first-child { 
        width: 30px !important;  /* TÄƒng tá»« 15px */
        height: 30px !important; 
        margin: 5px auto !important;
    }
    /* Chá»‰nh láº¡i tÃ³c cá»§a nhÃ¢n váº­t trong tháº» */
    .rank-card > div:first-child > div { height: 6px !important; }

    /* PhÃ³ng to TÃªn & Role */
    .rank-card div:nth-child(2) { 
        font-size: 10px !important; /* TÃªn NPC */
        margin: 3px 0 !important;
        font-weight: bold !important;
    } 
    .rank-card div:nth-child(3) { 
        font-size: 8px !important; /* Role: Vocal, Dance... */
        margin-bottom: 5px !important;
    }

    /* 4. Báº£ng chá»‰ sá»‘ (Voc, Dan, Rap, Wis, Cha): Quan trá»ng nháº¥t */
    .rank-card div:last-child {
        font-size: 8px !important; /* TÄƒng tá»« 5px lÃªn 8px cho dá»… Ä‘á»c */
        padding: 4px !important;
        background: rgba(0,0,0,0.05) !important;
        border-radius: 4px !important;
        grid-template-columns: 1fr 1fr !important; 
        gap: 3px !important;
        line-height: 1.2 !important;
    }

    /* 5. NÃºt "ENTER DORM" */
    #npc-intro-screen button {
        padding: 8px 25px !important;
        font-size: 12px !important;
        margin: 5px 0 !important;
        align-self: center !important;
    }

    #minigame-screen h2 {
        display: none; 
    }
    
    #minigame-canvas-container {
        width: 90vw !important; /* Chiáº¿m 90% chiá»u ngang mÃ n hÃ¬nh */
        height: 90vh !important; /* Chiáº¿m 90% chiá»u cao mÃ n hÃ¬nh */
        max-width: 600px !important; /* Giá»›i háº¡n láº¡i chÃºt Ä‘á»ƒ khÃ´ng bá»‹ dÃ i ngoáº±ng trÃªn mÃ¡y to */
        margin: 2vh auto !important; /* CÄƒn giá»¯a */
        border-width: 3px !important;
    }

    /* 2. Chá»‰nh láº¡i giao diá»‡n HÆ°á»›ng dáº«n (Tutorial) bÃªn trong */
    #mg-tutorial {
        padding: 10px !important;
        justify-content: center !important;
    }

    /* Icon (CÃ¡nh tay, Micro...) - Cho to lÃªn */
    #mg-tutorial > div:first-child { 
        font-size: 35px !important; 
        margin-bottom: 5px !important;
    }

    /* TiÃªu Ä‘á» (GYM TRAINING) */
    #mg-tutorial h2 {
        display: block !important;
        font-size: 14px !important; /* TÄƒng cá»¡ chá»¯ tiÃªu Ä‘á» */
        margin-bottom: 10px !important;
        color: #feca57 !important;
    }

    /* Há»™p ná»™i dung vÄƒn báº£n hÆ°á»›ng dáº«n */
    #mg-tutorial > div:nth-child(3) {
        font-size: 11px !important; /* TÄƒng tá»« 8px lÃªn 11px cho dá»… Ä‘á»c */
        line-height: 1.6 !important; /* GiÃ£n dÃ²ng ra cho thoÃ¡ng */
        padding: 10px !important;
        margin-bottom: 10px !important;
        width: 95% !important;
        background: rgba(255,255,255,0.15) !important;
        border: 2px solid #fff !important;
        border-radius: 8px !important;
        text-align: left !important;
    }
    
    /* Khoáº£ng cÃ¡ch cÃ¡c dÃ²ng chá»¯ */
    #mg-tutorial p {
        margin: 5px 0 !important;
    }

    /* NÃºt "I'M READY" - LÃ m to, dá»… báº¥m */
    #btn-tut-start {
        font-size: 12px !important;
        padding: 10px 30px !important;
        border-radius: 5px !important;
        border-bottom-width: 4px !important;
        background: #00b894 !important;
        color: #fff !important;
        cursor: pointer !important;
    }

    /* ThÃ´ng tin phá»¥ bÃªn dÆ°á»›i (TRAINING: EASY) */
    #minigame-info {
        font-size: 10px !important;
        margin-top: 5px !important;
        color: #aaa !important;
    }
    
    /* NÃºt EXIT */
    #minigame-screen > button {
        padding: 5px 15px !important;
        font-size: 10px !important;
        margin-top: 5px !important;
    }

    /* 1. Khung bao ngoÃ i (MÃ u vÃ ng nháº¡t) */
    #rel-screen .result-box {
        width: 95% !important;
        height: 90% !important;
        padding: 5px !important;
        display: flex;
        flex-direction: column;
    }

    /* TiÃªu Ä‘á» "RELATIONSHIP CHART" */
    #rel-screen h2 {
        font-size: 10px !important;
        margin: 2px 0 5px 0 !important;
    }

    /* 2. LÆ°á»›i hiá»ƒn thá»‹ (Grid) */
    /* 1. LÆ°á»›i hiá»ƒn thá»‹: TÄƒng kÃ­ch thÆ°á»›c cá»™t vÃ  hÃ ng */
    #rel-list-grid {
        display: grid !important;
        /* TÄƒng chiá»u rá»™ng tá»‘i thiá»ƒu cá»™t tá»« 60px lÃªn 100px -> Tháº» to gáº¥p Ä‘Ã´i */
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)) !important;
        
        /* TÄƒng chiá»u cao hÃ ng tá»« 80px lÃªn 130px */
        grid-auto-rows: 130px !important;
        
        gap: 8px !important;
        padding: 5px !important;
        overflow-y: auto !important; /* Cho phÃ©p cuá»™n */
        flex-grow: 1 !important;
    }

    /* 2. Tháº» quan há»‡: CÄƒn chá»‰nh láº¡i ná»™i dung */
    .rel-card {
        height: 100% !important;
        width: 100% !important;
        padding: 5px !important;
        border-width: 2px !important;
        border-radius: 8px !important;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly !important; /* Chia Ä‘á»u khoáº£ng cÃ¡ch */
        align-items: center;
    }

    /* 3. Avatar nhÃ¢n váº­t (To hÆ¡n) */
    .rel-card > div:first-child {
        width: 30px !important;  /* TÄƒng tá»« 12px lÃªn 30px */
        height: 30px !important;
        margin-bottom: 5px !important;
    }
    .rel-card > div:first-child > div { height: 6px !important; } /* TÃ³c dÃ y hÆ¡n */

    /* 4. TÃªn nhÃ¢n váº­t */
    .rel-card div:nth-child(2) {
        font-size: 10px !important; /* TÄƒng tá»« 6px lÃªn 10px */
        margin-bottom: 2px !important;
        font-weight: bold !important;
    }

    /* 5. Äiá»ƒm sá»‘ (MÃ u Ä‘á») */
    .rel-score {
        font-size: 12px !important; /* TÄƒng tá»« 8px lÃªn 12px */
        margin: 2px 0 !important;
    }

    /* 6. Tráº¡ng thÃ¡i (ACQUAINTANCE...) */
    .rel-status {
        font-size: 7px !important; /* TÄƒng tá»« 4px lÃªn 7px cho dá»… Ä‘á»c */
        padding: 4px 6px !important;
        border-radius: 4px !important;
        max-width: 95% !important;
    }

    /* 4. NÃºt CLOSE bÃªn dÆ°á»›i */
    #rel-screen > button {
        padding: 4px 15px !important;
        font-size: 8px !important;
        margin-top: 5px !important;
        height: 25px !important;
        align-self: center !important;
    }

    button[onclick="Game.showRelList()"], 
    button[onclick="Game.toggleSettings()"] {
        width: 110px !important;   /* Äá»™ rá»™ng báº±ng nhau */
        height: 28px !important;   /* Chiá»u cao báº±ng nhau */
        
        font-size: 8px !important; /* Cá»¡ chá»¯ nhá» Ä‘á»ƒ vá»«a 1 dÃ²ng */
        padding: 0 5px !important; /* Padding 2 bÃªn */
        
        /* CÄƒn giá»¯a chá»¯ */
        display: flex !important;
        align-items: center !important; 
        justify-content: center !important;
        
        /* QUAN TRá»ŒNG: Cáº¥m xuá»‘ng dÃ²ng */
        white-space: nowrap !important; 
        
        left: 10px !important;
        box-sizing: border-box !important;
    }

    /* Äáº·t vá»‹ trÃ­ nÃºt Relations (á»ž trÃªn) */
    button[onclick="Game.showRelList()"] {
        top: 10px !important;
        /* Náº¿u chá»¯ váº«n bá»‹ to, giáº£m font riÃªng nÃºt nÃ y xuá»‘ng xÃ­u */
        /* font-size: 7px !important; */ 
    }

    /* Äáº·t vá»‹ trÃ­ nÃºt Settings (á»ž dÆ°á»›i) */
    button[onclick="Game.toggleSettings()"] {
        top: 45px !important; /* CÃ¡ch nÃºt trÃªn khoáº£ng 5-7px (10 + 28 + 7 = 45) */
    }

    #settings-overlay .result-box {
        width: 50% !important;  /* Chá»‰ chiáº¿m 50% mÃ n hÃ¬nh thay vÃ¬ full */
        height: auto !important; /* Chiá»u cao tá»± co giÃ£n theo ná»™i dung */
        max-height: 90% !important;
        padding: 10px !important; /* Giáº£m padding */
        
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* 2. TiÃªu Ä‘á» "PAUSED" */
    #settings-overlay h1 {
        font-size: 16px !important; /* Giáº£m font chá»¯ tiÃªu Ä‘á» */
        margin: 5px 0 10px 0 !important;
    }

    /* 3. Label "AUDIO SETTINGS" */
    #settings-overlay label {
        font-size: 8px !important;
        margin-bottom: 2px !important;
    }

    /* 4. CÃ¡c khung chá»©a nÃºt báº¥m */
    #settings-overlay > .result-box > div {
        width: 100% !important;
        margin: 2px 0 !important;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* 5. Chá»‰nh láº¡i cÃ¡c nÃºt báº¥m (BGM, RESUME, QUIT) */
    #settings-overlay button {
        width: 70% !important; /* NÃºt gá»n láº¡i, khÃ´ng bÃ¨ ra 2 bÃªn */
        height: 25px !important; /* Chiá»u cao nÃºt cá»‘ Ä‘á»‹nh nhá» */
        padding: 0 !important;
        font-size: 8px !important;
        margin: 3px 0 !important; /* Khoáº£ng cÃ¡ch giá»¯a cÃ¡c nÃºt */
        
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #interaction-modal {
        /* 1. Má»Ÿ rá»™ng chiá»u ngang Ä‘á»ƒ táº­n dá»¥ng 2 bÃªn */
        width: 90% !important; 
        max-width: none !important; /* Bá» giá»›i háº¡n chiá»u rá»™ng cÅ© */
        
        /* 2. Ã‰p chiá»u cao vÃ  vá»‹ trÃ­ */
        height: auto !important;
        bottom: 10px !important; /* SÃ¡t mÃ©p dÆ°á»›i */
        top: auto !important;    /* Bá» cÄƒn giá»¯a dá»c */
        
        /* 3. Giao diá»‡n bÃªn trong */
        padding: 5px 10px !important;
        /* display: flex !important; */
        flex-direction: column !important;
        align-items: flex-start !important; /* CÄƒn ná»™i dung sang trÃ¡i */
    }

    /* TÃªn nhÃ¢n váº­t */
    #dialogue-npc-name {
        font-size: 10px !important;
        margin: 2px 0 !important;
        color: var(--primary) !important;
        text-align: left !important;
        width: 100%;
    }

    /* Nội dung lời thoại - tăng size cho tiếng Anh (trước 9px quá bé) */
    #dialogue-text {
        font-size: 14px !important;
        line-height: 1.5 !important;
        margin: 0 0 8px 0 !important;
        text-align: left !important;
        width: 100%;
    }
    body.lang-vi #dialogue-text {
        font-size: 13px !important; /* Tiếng Việt: câu hỏi nhỏ hơn một chút */
    }

    /* Khu vực các nút bấm */
    #dialogue-options {
        width: 100% !important;
        display: flex !important;
        flex-direction: row !important;
        gap: 6px !important;
        justify-content: space-between !important;
    }

    /* Các nút lựa chọn - tăng size (trước 7px quá bé, đặc biệt tiếng Việt) */
    #dialogue-options button,
    #dialogue-options .dialogue-btn {
        flex: 1 !important;
        width: auto !important;
        margin: 0 !important;
        padding: 8px 4px !important;
        font-size: 11px !important;
        
        /* Xá»­ lÃ½ text trong nÃºt */
        white-space: normal !important; /* Cho phÃ©p xuá»‘ng dÃ²ng náº¿u chá»¯ dÃ i */
        line-height: 1.1 !important;
        display: flex;
        align-items: center;
        justify-content: center;
        height: auto !important;
        min-height: 25px !important;
    }

    #char-preview {
        width: 140px !important;  /* TÄƒng kÃ­ch thÆ°á»›c hiá»ƒn thá»‹ */
        height: 140px !important;
        border-width: 3px !important;
        margin-bottom: 5px !important;
    }

    .color-label {
        font-size: 7px !important;
        margin-bottom: 2px !important;
    }

    /* Äiá»u chá»‰nh láº¡i layout Create Box Ä‘á»ƒ chá»©a Ä‘á»§ Preview to */
    #create-box {
        flex-direction: row !important;
        align-items: center !important;
        padding: 10px !important;
    }

    .color-picker-container {
        display: flex;
        align-items: center;
        width: 100%;
        gap: 5px;
        margin-bottom: 5px;
    }

    .color-picker-row {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        
        /* Cá»‘ Ä‘á»‹nh chiá»u rá»™ng: 4 Ã´ (25px) + 3 gap (5px) + 2 padding bÃªn (5px) = 125px */
        width: 125px !important; 
        max-width: 125px !important;
        
        /* QUAN TRá»ŒNG: CÄƒn trÃ¡i Ä‘á»ƒ Ã´ Ä‘áº§u tiÃªn khÃ´ng bá»‹ Ä‘áº©y ra ngoÃ i */
        justify-content: flex-start !important; 
        
        overflow-x: auto !important;
        overflow-y: hidden !important;
        
        gap: 5px !important;
        
        /* Äá»‡m 2 Ä‘áº§u Ä‘á»ƒ Ã´ Ä‘áº§u vÃ  Ã´ cuá»‘i khÃ´ng dÃ­nh lá» */
        padding: 0 2px !important; 
        
        margin: 0 !important;
        
        /* Giá»¯ layout cá»‘ Ä‘á»‹nh */
        box-sizing: border-box !important;
        scroll-behavior: smooth;
        
        scroll-snap-type: x mandatory; 
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* ThÃªm class nÃ y Ä‘á»ƒ xá»­ lÃ½ tráº¡ng thÃ¡i Ä‘ang chá»n */
    .color-btn.active {
        border: 2px solid #000 !important; /* Viá»n Ä‘en Ä‘áº­m */
        transform: scale(0.9); /* Thu nhá» xÃ­u Ä‘á»ƒ khÃ´ng lÃ m vá»¡ khung */
    }

    /* Äáº£m báº£o nÃºt mÃ u luÃ´n cá»©ng kÃ­ch thÆ°á»›c */
    .color-btn {
        width: 25px !important;
        height: 25px !important;
        min-width: 25px !important;
        flex-shrink: 0 !important;
        border: 1px solid #fff !important;
        border-radius: 2px !important;
        scroll-snap-align: start; 
        box-sizing: border-box !important; /* Quan trá»ng Ä‘á»ƒ viá»n khÃ´ng lÃ m to nÃºt */
    }

    /* NÃºt mÅ©i tÃªn Ä‘iá»u hÆ°á»›ng */
    .nav-arrow {
        background: #2f3542 !important;
        color: #fff !important;
        border: none !important;
        box-shadow: none !important;
        padding: 5px !important;
        width: 25px !important;
        height: 25px !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 10px !important;
        flex-shrink: 0;
        border-radius: 4px;
    }

    .nav-arrow:active {
        transform: scale(0.9);
    }
    
    .color-section {
        width: 100% !important;
        margin-bottom: 5px !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
    }
    .picker-container {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 200px !important; /* Äá»™ rá»™ng cá»‘ Ä‘á»‹nh cho 4 mÃ u + 2 nÃºt */
        margin: 0 auto !important;
        gap: 5px !important;
    }

    #ranking-list .rank-card {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;     /* CÄƒn giá»¯a cÃ¡c div con theo chiá»u ngang */
        justify-content: center !important;  /* CÄƒn giá»¯a cÃ¡c div con theo chiá»u dá»c */
        text-align: center !important;
        padding: 5px !important;
        box-sizing: border-box !important;
    }

    #ranking-list .rank-card > div {
        width: 100% !important;             /* QUAN TRá»ŒNG: Div con pháº£i rá»™ng 100% thÃ¬ text-align má»›i cÃ³ tÃ¡c dá»¥ng */
        text-align: center !important;       /* Ã‰p chá»¯ bÃªn trong div ra chÃ­nh giá»¯a */
        margin: 0 !important;                /* XÃ³a cÃ¡c margin máº·c Ä‘á»‹nh cÃ³ thá»ƒ gÃ¢y lá»‡ch */
    }

    #ranking-list .rank-card > div:first-child {
        font-size: 18px !important;    
        font-weight: bold !important;  
        color: #2f3542 !important;     
        margin-bottom: 4px !important;      
        text-shadow: 1px 1px 0px #fff; 
        line-height: 1 !important;           
    }

    #ranking-list .rank-card div:nth-child(2) {
        font-size: 10px !important;
        margin-bottom: 2px !important;
    }

    #ranking-list .rank-card div:last-child {
        font-size: 11px !important;
        font-weight: bold !important;
        color: #e67e22 !important;
    }

    #draft-title {
        display: none !important; 
    }

    #draft-visual {
        width: 98% !important;        /* Má»Ÿ rá»™ng bá» ngang */
        height: 85vh !important;      /* Chiáº¿m 85% chiá»u cao mÃ n hÃ¬nh */
        margin: 5px auto !important;  /* CÄƒn giá»¯a gá»n gÃ ng */
        border-width: 3px !important;
        background: #dfe6e9 !important;
        
        /* Äáº£m báº£o canvas bÃªn trong khÃ´ng bá»‹ mÃ©o */
        display: flex !important;
        align-items: center;
        justify-content: center;
    }

    /* 3. Canvas Ã©p full khung */
    #draftCanvas {
        width: 100% !important;
        height: 100% !important;
        display: block !important;
    }

    /* 4. DÃ²ng tráº¡ng thÃ¡i nhá» gá»n bÃªn dÆ°á»›i */
    #draft-status {
        font-size: 8px !important;
        margin: 2px 0 !important;
        position: absolute;
        bottom: 5px;
        right: 10px;
        background: rgba(255,255,255,0.8);
        padding: 2px 5px;
        border-radius: 4px;
        z-index: 10;
    }

    /* 5. NÃºt START COMPETITION: Ná»•i báº­t á»Ÿ gÃ³c hoáº·c dÆ°á»›i Ä‘Ã¡y */
    #btn-start-event {
        position: absolute !important;
        bottom: 10px !important; /* Äáº·t Ä‘Ã¨ lÃªn gÃ³c dÆ°á»›i cá»§a mÃ n hÃ¬nh */
        left: 50% !important;
        transform: translateX(-50%) !important;
        z-index: 20 !important;
        
        padding: 10px 30px !important;
        font-size: 14px !important;
        background: #ff6b81 !important; 
        color: #fff !important;
        border: 2px solid #fff !important;
        box-shadow: 0 4px 0 #2f3542 !important;
    }

    #comp-screen {
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        width: 100% !important;
        height: 100% !important;
    }

    /* Khung chá»©a Canvas khÃ´ng bá»‹ trÃ n */
    #comp-canvas-wrapper {
        width: 85vw !important;
        height: 85vh !important;
        margin: 0 auto !important;
        border: 2px solid #fff !important;
        box-shadow: 0 0 10px rgba(0,0,0,0.5) !important;
    }

    /* 2. Giao diá»‡n Káº¿t quáº£: Chia Ä‘Ã´i mÃ n hÃ¬nh (TrÃ¡i/Pháº£i) */
    .res-layout {
        display: flex !important;
        flex-direction: row !important; /* Xáº¿p ngang */
        width: 95% !important;
        height: 80% !important;
        align-items: center !important;
        gap: 15px !important;
    }

    /* BÃªn TrÃ¡i: Báº£ng Xáº¿p Háº¡ng */
    .res-left {
        flex: 2 !important; /* Chiáº¿m 2/3 mÃ n hÃ¬nh */
        height: 100% !important;
        overflow-y: auto !important;
        border: 2px solid #2f3542 !important;
        background: #fff !important;
        border-radius: 8px !important;
        padding: 5px !important;
    }

    /* BÃªn Pháº£i: Äiá»ƒm sá»‘ & NÃºt báº¥m */
    .res-right {
        flex: 1 !important; /* Chiáº¿m 1/3 mÃ n hÃ¬nh */
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important;
        align-items: center !important;
        height: 100% !important;
    }

    /* Tinh chá»‰nh nÃºt báº¥m cho gá»n */
    .res-btn {
        width: 100% !important;
        padding: 10px 0 !important;
        font-size: 10px !important;
        margin-top: 10px !important;
    }

    /* Thu nhá» tiÃªu Ä‘á» Ä‘á»ƒ khÃ´ng chiáº¿m chá»— */
    #round-result-overlay h2, 
    #comp-result-overlay h1 {
        font-size: 14px !important;
        margin-bottom: 5px !important;
        margin-top: 0 !important;
    }

    /* Sá»­a láº¡i cÃ¡i khung chá»©a canvas bÃªn trong */
    #comp-screen > div:first-of-type {
        width: 90% !important; 
        height: 80% !important; /* Thay vÃ¬ 450px cá»‘ Ä‘á»‹nh, hÃ£y dÃ¹ng % */
        max-height: 500px; /* Giá»›i háº¡n tá»‘i Ä‘a Ä‘á»ƒ khÃ´ng quÃ¡ to */
        margin: 0 !important; /* Bá» margin auto cÅ© */
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #room-notification {
        position: fixed !important;      /* LuÃ´n cá»‘ Ä‘á»‹nh theo mÃ n hÃ¬nh, khÃ´ng theo Map */
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        
        width: 85% !important;           /* Chiáº¿m 85% chiá»u ngang mÃ n hÃ¬nh */
        max-width: 400px !important;
        height: auto !important;
        max-height: 90vh !important;     /* KhÃ´ng cao quÃ¡ 90% mÃ n hÃ¬nh */
        
        overflow-y: auto !important;     /* Cho phÃ©p cuá»™n náº¿u ná»™i dung quÃ¡ dÃ i */
        z-index: 5000 !important;        /* LuÃ´n ná»•i lÃªn trÃªn cÃ¹ng */
        
        background: #fff !important;
        border: 4px solid #2f3542 !important;
        border-radius: 10px !important;
        padding: 15px !important;
        box-shadow: 0 0 0 1000px rgba(0,0,0,0.6) !important; /* LÃ m tá»‘i ná»n Ä‘áº±ng sau */
    }

    /* Tinh chá»‰nh nÃºt chá»n file cho to dá»… báº¥m */
    #stage-setup-area button {
        padding: 12px !important;
        margin-top: 5px !important;
        font-size: 10px !important;
    }

    #stage-detail-overlay {
        align-items: center !important;
        justify-content: center !important;
        padding: 0 !important;
        background: rgba(0,0,0,0.85) !important;
    }

    /* TiÃªu Ä‘á» STAGE CLEAR */
    #stage-detail-overlay h1 {
        position: absolute;
        top: 10px;
        font-size: 24px !important;
        margin: 0 !important;
        z-index: 10;
        width: 100%;
        text-align: center;
    }

    /* Khung chá»©a ná»™i dung káº¿t quáº£ */
    #stage-detail-content {
        width: 95vw !important;
        max-width: 420px !important;
        height: auto !important;
        max-height: 85vh !important;
        margin-top: 20px !important;
        background: #fff !important;
        border: 4px solid #fff !important;
        border-radius: 12px !important;
        box-shadow: 0 0 20px rgba(255,255,255,0.2) !important;
        padding: 15px !important;
        overflow-y: auto !important;
    }

    /* --- LAYOUT CHIA ÄÃ”I (TrÃ¡i - Pháº£i) --- */
    /* Stage result - giữ column, tránh ép row gây chữ đứng dọc */
    #stage-detail-content .stage-res-layout {
        flex-direction: column !important;
        min-width: min(95vw, 380px) !important;
        max-width: 95vw !important;
    }
    #stage-detail-content .stage-res-layout h2,
    #stage-detail-content .stage-res-layout button {
        white-space: nowrap !important;
    }

    .stage-res-layout {
        display: flex !important;
        width: 100%;
        height: 100%;
    }

    /* Cá»™t TrÃ¡i: Háº¡ng (S, A, B) & Äá»™ khÃ³ */
    .sr-left {
        flex: 1 !important;
        background: #f1f2f6;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        border-right: 2px dashed #ccc;
    }

    /* Cá»™t Pháº£i: Chi tiáº¿t Ä‘iá»ƒm & NÃºt */
    .sr-right {
        flex: 1.5 !important; /* Rá»™ng hÆ¡n chÃºt Ä‘á»ƒ chá»©a báº£ng Ä‘iá»ƒm */
        padding: 10px 20px !important;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    /* Tinh chá»‰nh text trong cá»™t trÃ¡i */
    .grade-text { font-size: 60px !important; margin: 5px 0 !important; }
    .acc-text { font-size: 10px !important; }
    .diff-stars { font-size: 10px !important; margin-top: 5px !important; }

    /* Tinh chá»‰nh báº£ng Ä‘iá»ƒm bÃªn pháº£i */
    .score-row {
        display: flex;
        justify-content: space-between;
        font-size: 10px !important;
        margin-bottom: 6px !important;
        border-bottom: 1px solid #eee;
        padding-bottom: 2px;
    }

    /* Tá»•ng Ä‘iá»ƒm to */
    .total-score-box {
        background: #feca57 !important;
        color: #fff !important;
        text-shadow: 1px 1px 0 #d35400;
        font-size: 18px !important;
        padding: 8px !important;
        text-align: center;
        border-radius: 6px;
        margin: 10px 0 !important;
    }

    /* NÃºt Continue */
    #btn-stage-continue {
        width: 100%;
        padding: 12px !important;
        background: #00b894 !important;
        color: #fff !important;
        border: none !important;
        border-radius: 4px;
        font-size: 12px !important;
        box-shadow: 0 4px 0 #006266;
    }

    button[onclick="Game.showRelList()"], 
    button[onclick="Game.toggleSettings()"] {
        /* THAY ĐỔI: Sử dụng width tự động hoặc tăng chiều rộng */
        width: 140px !important;    /* Tăng từ 110px lên 140px để chứa đủ chữ tiếng Việt */
        height: 32px !important;    /* Tăng nhẹ chiều cao để chữ không chạm viền */
        
        font-size: 11px !important; /* Giảm nhẹ font size riêng cho mobile nếu vẫn tràn */
        padding: 0 8px !important;
        
        display: flex !important;
        align-items: center !important; 
        justify-content: center !important;
        white-space: nowrap !important; 
        left: 10px !important;
        box-sizing: border-box !important;
    }

    button[onclick="Game.showRelList()"] {
        top: 10px !important;
    }

    button[onclick="Game.toggleSettings()"] {
        top: 48px !important; /* Điều chỉnh lại khoảng cách top để không đè nhau */
    }
}

/* --- TÄ‚NG KÃCH THÆ¯á»šC NÃšT START GAME --- */
#title-screen button {
    font-size: 20px !important;       /* Chá»¯ to hÆ¡n (gáº¥p Ä‘Ã´i bÃ¬nh thÆ°á»ng) */
    padding: 20px 60px !important;    /* NÃºt dÃ y vÃ  dÃ i hÆ¡n */
    border-width: 4px !important;     /* Viá»n dÃ y hÆ¡n */
    margin-top: 50px !important;      /* CÃ¡ch xa tiÃªu Ä‘á» má»™t chÃºt */
    box-shadow: 6px 6px 0 #000 !important; /* BÃ³ng Ä‘á»• Ä‘áº­m hÆ¡n */
    
    /* Hiá»‡u á»©ng nháº¥p nhÃ¡y nháº¹ Ä‘á»ƒ má»i gá»i báº¥m */
    animation: pulse 1.5s infinite alternate;
}

@keyframes pulse {
    from { transform: scale(1); }
    to { transform: scale(1.05); }
}

/* --- SONG DRAFT PREVIEW OVERLAY --- */
#song-draft-overlay {
    position: absolute; top: 0; left: 0; 
    width: 100%; height: 100%;
    background: rgba(45, 52, 54, 0.98); /* Ná»n tá»‘i má» */
    z-index: 9999;
    display: flex; flex-direction: column; 
    align-items: center; justify-content: center;
    color: #fff;
}

.draft-header {
    text-align: center;
    margin-bottom: 20px;
}

.song-grid {
    display: flex; 
    flex-wrap: wrap; /* Tá»± Ä‘á»™ng rá»›t dÃ²ng náº¿u thiáº¿u chá»— */
    gap: 15px; 
    justify-content: center;
    width: 95%; 
    max-width: 800px;
    max-height: 60vh; /* Chá»‘ng trÃ n mÃ n hÃ¬nh trÃªn mobile nhá» */
    overflow-y: auto; /* Cho phÃ©p cuá»™n náº¿u quÃ¡ nhiá»u */
    padding: 10px;
}

.song-card {
    background: #2f3542; 
    border: 3px solid #74b9ff; 
    border-radius: 12px;
    padding: 15px; 
    width: calc(50% - 15px); /* Mobile: 2 cá»™t */
    min-width: 130px;
    max-width: 160px;
    text-align: center; 
    display: flex; 
    flex-direction: column; 
    justify-content: space-between;
    box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
    transition: transform 0.1s;
}

.song-card:active {
    transform: scale(0.95);
}

.song-title {
    font-size: 12px; 
    font-weight: bold; 
    color: #fff; 
    margin-bottom: 5px;
    word-wrap: break-word;
}

.song-concept {
    font-size: 9px; 
    color: #ff9ff3; 
    margin-bottom: 15px;
    background: rgba(0,0,0,0.3);
    padding: 3px;
    border-radius: 3px;
}

.play-preview-btn {
    background: #00b894; 
    color: white; 
    border: 2px solid #fff; 
    padding: 8px 5px; 
    border-radius: 8px; 
    font-size: 9px;
    font-family: inherit;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 3px 0 #008c72;
}

.play-preview-btn.playing {
    background: #d63031;
    box-shadow: 0 3px 0 #b33939;
}

.draft-action-btn {
    margin-top: 20px;
    background: #e84393;
    color: #fff;
    border: 3px solid #fff;
    padding: 15px 20px;
    font-family: inherit;
    font-size: 12px;
    font-weight: bold;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 5px 0 #b33939;
}

@media (min-width: 768px) {
    .song-card { width: 140px; } 
    .song-title { font-size: 14px; }
}

/* --- RESPONSIVE MINIGAME WRAPPER --- */
.responsive-game-wrapper {
    position: relative;
    background: #000;
    border: 4px solid #fff;
    border-radius: 8px;
    overflow: hidden; 
    touch-action: none;
    user-select: none;
    
    width: 95vw; 
    max-width: 800px; 
    
    aspect-ratio: 4 / 3; 
    max-height: 75vh; 
}

.responsive-game-wrapper canvas {
    display: block;
    width: 100%;
    height: 100%;
}

.game-overlay {
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.85); 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; 
    color: #fff; 
    z-index: 10;
}

#comp-overlay button {
    position: relative;
    z-index: 100 !important; 
    pointer-events: auto !important;
}

body.lang-vi {
    font-family: 'VT323', 'Press Start 2P', cursive;
    letter-spacing: 0.25px;
    font-size-adjust: 0.72;
}

body.lang-vi button,
body.lang-vi input,
body.lang-vi textarea,
body.lang-vi select,
body.lang-vi #game-container {
    font-family: 'VT323', 'Press Start 2P', cursive !important;
    font-size-adjust: 0.72;
}

body.lang-vi h1,
body.lang-vi h2,
body.lang-vi h3,
body.lang-vi button,
body.lang-vi label,
body.lang-vi p,
body.lang-vi span,
body.lang-vi div {
    line-height: 1.25;
}

body.lang-vi button { font-size: 12px !important; }
body.lang-vi h1 { font-size: 22px; }
body.lang-vi h2 { font-size: 20px; }
body.lang-vi h3 { font-size: 18px; }
body.lang-vi #hub-stats-display,
body.lang-vi #room-notification,
body.lang-vi #interaction-modal,
body.lang-vi #minigame-info,
body.lang-vi #day-summary-screen,
body.lang-vi #result-screen,
body.lang-vi #settings-overlay {
    font-size: 1.18em;
}

body.lang-vi #dialogue-text { font-size: 18px !important; line-height: 2.05 !important; letter-spacing: 0.35px; }
body.lang-vi #dialogue-npc-name { font-size: 24px !important; }
body.lang-vi .dialogue-btn { font-size: 16px !important; line-height: 1.55; padding: 18px 12px; }
body.lang-vi #game-toast { font-size: 15px !important; line-height: 1.8 !important; letter-spacing: 0.3px; }
body.lang-vi #room-notification p { line-height: 1.7 !important; }
body.lang-vi #mg-countdown { font-size: 100px !important; letter-spacing: 2px; text-align: center !important; font-family: 'VT323', 'Press Start 2P', cursive !important; }
body.lang-vi #btn-tut-start {
    font-family: 'VT323', 'Press Start 2P', cursive !important;
    text-align: center !important;
    display: inline-flex !important;
    justify-content: center !important;
    align-items: center !important;
    margin-left: auto !important;
    margin-right: auto !important;
}
body.lang-vi #minigame-info { font-size: 16px !important; line-height: 1.6; }
body.lang-vi #day-summary-screen { font-size: 1.28em; }
body.lang-vi #day-summary-screen h1 { font-size: 34px !important; }
body.lang-vi #day-summary-screen button { font-size: 16px !important; padding: 16px 22px !important; }
body.lang-vi #elimination-msg { font-size: 14px !important; line-height: 1.5; }
body.lang-vi #interaction-modal { max-width: 760px; }

@media (max-width: 1024px) {
    #game-container {
        width: 100vw;
        height: 100dvh;
        min-height: 100dvh;
    }

    h1 { font-size: clamp(18px, 5vw, 26px) !important; }
    h2 { font-size: clamp(14px, 4.2vw, 20px) !important; }
    button { font-size: clamp(10px, 2.8vw, 14px) !important; }

    #hub-stats-display {
        top: 8px !important;
        right: 8px !important;
        min-width: 132px;
        padding: 10px 12px;
        font-size: 10px;
        line-height: 1.45;
    }

    #room-notification {
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: min(92vw, 430px) !important;
        max-height: 86dvh !important;
        overflow-y: auto;
        padding: 14px !important;
    }

    #room-action-btn,
    #room-cancel-btn {
        width: 100%;
        margin: 6px 0;
    }

    #interaction-modal {
        width: min(94vw, 760px) !important;
        max-width: min(94vw, 760px) !important;
        bottom: 3% !important;
        padding: 18px !important;
    }

    #minigame-canvas-container {
        width: min(96vw, 860px) !important;
        height: min(58dvh, 520px) !important;
        border-width: 3px !important;
    }

    #comp-canvas-wrapper {
        width: min(96vw, 900px) !important;
        height: min(60dvh, 540px) !important;
        margin-top: 8px !important;
    }

    #comp-title {
        font-size: clamp(12px, 3.3vw, 18px) !important;
        margin: 8px 0 !important;
        padding: 0 8px;
    }

    #draft-visual {
        width: 96% !important;
        height: min(72dvh, 580px) !important;
    }

    #ranking-list {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        overflow-x: auto !important;
        gap: 8px !important;
        padding: 6px !important;
        -webkit-overflow-scrolling: touch;
    }
    #ranking-list .rank-card {
        flex: 0 0 auto !important;
        min-width: 110px !important;
    }

    #team-reveal-screen {
        overflow-x: hidden !important; /* Tránh vuốt ngang bị trượt */
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
    }

    #team-reveal-screen .team-reveal-wrap {
        justify-content: flex-start !important;
        height: auto !important;
        min-height: 100dvh !important;
        padding: 30px 0 50px !important;
        box-sizing: border-box !important;
    }

    #final-team-score-list {
        display: flex !important;
        flex-direction: column !important;
        width: 95% !important;
        max-width: 600px !important;
        margin: 0 auto !important; /* Căn giữa */
        gap: 0px !important; /* Margin-bottom đã set trong JS nên gap để 0 */
        padding: 10px !important;
        box-sizing: border-box !important;
    }

    /* Đảm bảo các dòng hiển thị điểm luôn chiếm đủ 100% thay vì bị bóp nhỏ */
    #final-team-score-list > div {
        width: 100% !important;
        max-width: none !important;
        flex: none !important;
    }

    #final-team-score-list .rank-card .rank-avatar,
    #ranking-list .rank-card .rank-avatar {
        display: none !important; 
    }

    .rank-card {
        width: auto !important;
        max-width: none !important;
        min-height: 155px !important;
        height: auto !important;
        padding: 8px 6px !important;
    }

    .result-box {
        width: 95% !important;
        height: auto !important;
        max-height: 74dvh !important;
    }

    #result-screen .result-box {
        overflow-x: auto !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
    }

    #team-reveal-screen {
        overflow-x: auto !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
    }

    #team-reveal-screen .team-reveal-wrap {
        justify-content: flex-start !important;
        height: auto !important;
        min-height: 100dvh !important;
        padding: 16px 0 20px !important;
    }

    .score-box {
        width: min(92vw, 420px);
        padding: 14px;
    }

    /* Bảng kết quả: layout ngang (trái-phải) */
    .res-layout {
        flex-direction: row !important;
        width: 96% !important;
        height: auto !important;
        max-height: 84dvh !important;
        gap: 12px !important;
        overflow: auto;
        padding-bottom: 8px;
    }

    .res-table,
    .res-summary {
        width: auto !important;
        flex: 1 1 auto !important;
        max-width: none !important;
    }

    #stage-ui {
        flex-direction: row !important;
    }

    .side-panel {
        width: 180px !important;
        min-height: auto !important;
        border-right: 3px solid #2f3542 !important;
        border-bottom: none !important;
        order: 1;
    }

    #main-stage {
        flex: 1 !important;
        min-height: 45dvh !important;
        border-left: none !important;
        border-right: none !important;
        order: 2;
    }

    #title-screen button {
        font-size: clamp(14px, 4vw, 20px) !important;
        padding: 14px 28px !important;
        margin-top: 26px !important;
    }

    /* Gộp từ màn nhỏ + landscape - layout ngang */
    #npc-list-grid {
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)) !important;
    }
    #rel-list-grid {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        overflow-x: auto !important;
        gap: 8px !important;
        -webkit-overflow-scrolling: touch;
    }
    #rel-list-grid .rel-card {
        flex: 0 0 auto !important;
        min-width: 100px !important;
    }
    #dialogue-text { font-size: 15px !important; line-height: 1.6 !important; }
    .dialogue-btn, #dialogue-options button { font-size: 12px !important; padding: 10px 6px !important; }
    #game-toast { width: min(92vw, 420px); font-size: 12px !important; }
    #comp-canvas-wrapper,
    #minigame-canvas-container,
    #draft-visual {
        height: min(76dvh, 540px) !important;
    }
}

@media (min-width: 1024px) {
    /* 1. Phóng to toàn bộ bảng chứa kết quả */
    #result-screen .result-box {
        width: 95% !important;
        max-width: 1800px !important;
        height: 85vh !important;
        padding: 30px !important;
    }

    /* 2. Giãn khoảng cách các cột trong lưới để không bị dính vào nhau */
    #ranking-list {
        grid-template-columns: repeat(9, 1fr) !important; /* Hiển thị đủ 10 cột đẹp mắt */
        gap: 20px !important;
        padding: 20px !important;
    }

    /* 3. Tăng kích thước tổng thể của thẻ nhân vật */
    .rank-card {
        width: 100% !important; 
        height: 220px !important; /* Tăng chiều cao để có chỗ cho chữ to */
        gap: 10px !important; /* Tạo khoảng thở giữa các dòng chữ */
    }

    /* 4. Chữ TÊN NHÂN VẬT to hơn hẳn */
    #ranking-list .rank-card > div:first-child {
        font-size: 22px !important; 
        line-height: 1.3 !important;
        margin-bottom: 8px !important;
    }

    /* 5. Chữ HẠNG (#1, #2...) và mũi tên to hơn một chút */
    #ranking-list .rank-card > div:first-child span {
        font-size: 16px !important; 
        padding-bottom: 5px;
        display: inline-block;
    }

    /* 6. ĐIỂM TỔNG (VD: 3.5k) to và đậm hơn */
    #ranking-list .rank-card > div:nth-child(2) {
        font-size: 20px !important; 
        font-weight: 900 !important;
        color: #2f3542 !important;
    }

    /* 7. ĐIỂM CỘNG (VD: +3.5k) to hơn để dễ nhìn */
    #ranking-list .rank-card > div:last-child {
        font-size: 14px !important; 
        font-weight: bold !important;
        margin-top: 5px !important;
    }
}
