var Lang = {
    current: "en",
    dict: {
        en: {
            paused: "PAUSED",
            audio_settings: "AUDIO SETTINGS",
            language: "LANGUAGE",
            resume_game: "RESUME GAME",
            quit_to_title: "QUIT TO TITLE",
            start_game: "START GAME",
            trainee_profile: "TRAINEE PROFILE",
            points: "POINTS",
            name: "NAME",
            confirm_debut: "CONFIRM DEBUT",
            enter_dorm: "ENTER DORM",
            relations: "RELATIONS",
            settings: "SETTINGS",
            song_preview: "SONG PREVIEW",
            song_preview_desc: "LISTEN TO THE 5 STAGE SONGS<br>(30s PREVIEW)",
            song_preview_next: "NEXT: PLAY MINIGAME FOR PICKING ORDER",
            song_selection: "SONG SELECTION",
            pick_order_info: "Pick order based on Minigame Rank!",
            your_turn_pick: "YOUR TURN TO PICK!",
            team_is_picking: "Team {name} is picking...",
            go_preparation_room: "GO TO PREPARATION ROOM",
            play_30s: "PLAY 30s",
            stop: "STOP",
            selected_song: "SELECTED: {name}",
            selected_song_len: "SELECTED: {name}<br>(Length: {dur})",
            welcome_day: "WELCOME TO IDOL DORM!<br>DAY {day}",
            room_team_battle: "TEAM BATTLE",
            room_final_debut: "FINAL DEBUT STAGE",
            prepare_performance: "PREPARE PERFORMANCE",
            stage_suffix: "STAGE",
            no_stamina: "NO STAMINA! GO TO DORM.",
            rested: "RESTED!",
            daily_breakdown: "DAILY BREAKDOWN",
            minigame_score: "MINIGAME SCORE:",
            event_bonus: "EVENT BONUS:",
            livestage_score: "LIVESTAGE SCORE:",
            total_gain: "TOTAL GAIN:",
            complete_day: "COMPLETE DAY",
            ranking_board: "RANKING BOARD",
            next_day: "NEXT DAY",
            team_battle_results: "TEAM BATTLE RESULTS",
            continue_to_ranking: "CONTINUE TO RANKING",
            draft_title: "TEAM SELECTION",
            draft_status: "LEADERS ARE PICKING...",
            start_competition: "START COMPETITION",
            random_team_draw: "RANDOM TEAM DRAW",
            go_stage: "GO STAGE",
            rel_chart: "RELATIONSHIP CHART",
            close: "CLOSE",
            training: "TRAINING",
            exit: "EXIT",
            result: "RESULT",
            try_again: "TRY AGAIN",
            quit: "QUIT",
            end_livestage: "END LIVESTAGE",
            failed: "FAILED",
            quit_get_score: "QUIT (GET SCORE)",
            eliminated: "ELIMINATED",
            dont_give_up: "DON'T GIVE UP ON YOUR DREAM!",
            survived: "SURVIVED:",
            final_rank: "FINAL RANK:",
            total_votes: "TOTAL VOTES:",
            main_menu: "MAIN MENU",
            try_again_main: "TRY AGAIN",
            now_playing: "NOW PLAYING",
            select_difficulty: "SELECT DIFFICULTY:",
            start_stage: "START STAGE",
            cancel: "CANCEL",
            drafted_song: "DRAFTED SONG:",
            apppeal_time: "APPEAL TIME!",
            heart_desc: "CATCH FALLING HEARTS TO GAIN VOTES!",
            rotate_device: "PLEASE ROTATE YOUR DEVICE",
            bgm_on: "BGM ON",
            bgm_off: "BGM OFF",
            lang_btn_en: "English",
            lang_btn_vi: "Tiếng Việt",
            quit_confirm: "Quit to Title Screen? Unsaved progress will be lost.",
            click_enable_audio: "CLICK SCREEN TO ENABLE AUDIO",
            missing_music: "MISSING MUSIC",
            cannot_load_audio: "CANNOT LOAD LOCAL AUDIO",
            team_picked: "Your team picked {name}!",
            error_loading_stage_audio: "ERROR LOADING STAGE AUDIO",
            click_continue: "Click anywhere to continue...",
            elim_bottom_leave: "ELIMINATION: BOTTOM {num} LEAVE!",
            round_result: "ROUND {n} RESULT",
            team: "TEAM",
            perf: "PERF",
            pts: "PTS",
            earned: "EARNED",
            next: "NEXT >>",
            finish: "FINISH",
            final_standings: "FINAL STANDINGS",
            ranking_bonus: "RANKING BONUS",
            complete_event: "COMPLETE EVENT",
            survivor: "SURVIVOR",
            elim_short: "ELIM",
            mg_training_prefix: "TRAINING",
            mg_vocal_title: "VOCAL TRAINING",
            mg_dance_title: "DANCE TRAINING",
            mg_rap_title: "RAP TRAINING",
            mg_gym_title: "GYM TRAINING",
            mg_vocal_ins_1: "1. Left click continuously to flap.",
            mg_vocal_ins_2: "2. Dodge pipes and avoid touching ground.",
            mg_vocal_ins_3: "3. Survive longer for higher score.",
            mg_dance_ins_1: "1. Watch the highlighted key sequence.",
            mg_dance_ins_2: "2. Repeat with: D - F - J - K.",
            mg_dance_ins_3: "3. Sequence gets longer each round.",
            mg_rap_ins_1: "1. Read the keyword above.",
            mg_rap_ins_2: "2. Type it exactly in the box.",
            mg_rap_ins_3: "3. Type fast before timer ends.",
            mg_gym_ins_1: "1. White bar moves left-right.",
            mg_gym_ins_2: "2. Press SPACE in the green zone.",
            mg_gym_ins_3: "3. Zone shrinks and speed increases.",
            mg_ready: "I'M READY!",
            mg_watch: "WATCH",
            mg_start: "START!",
            mg_success: "SUCCESS",
            mg_tap_hint: "TAP BUTTONS or PRESS D-F-J-K",
            fans: "FANS",
            teamwork: "TEAMWORK",
            dialog_like: "liked that! (+5 Rel)",
            dialog_dislike: "disappointed... (-5 Rel)",
            dialog_normal: "Just a normal conversation.",
            rel_bestie: "BESTIE",
            rel_friend: "FRIEND",
            rel_rival: "RIVAL",
            rel_acquaintance: "ACQUAINTANCE",
            
            // THƯ VIỆN LỜI THOẠI TIẾNG ANH
            dialogues: [
                { text: "I'm nervous about tomorrow's elimination...", options: ["No matter what happens, you did your best.", "Yeah... it's scary.", "If you get eliminated, that's on you."] },
                { text: "Do you think my high note was stable?", options: ["It was amazing! You improved so much!", "It was okay.", "It was off-key."] },
                { text: "I stayed up all night practicing the choreography.", options: ["I'm proud of your hard work!", "You should rest too.", "That's your problem."] },
                { text: "The judges barely looked at me today...", options: ["They'll notice you soon, trust me.", "Maybe next round.", "Maybe you're just not interesting."] },
                { text: "I'm scared I'll disappoint the team.", options: ["We win and lose together.", "Just try your best.", "Don't drag us down then."] },
                { text: "Do you want to practice vocals together tonight?", options: ["Of course! Let's improve together.", "Maybe later.", "Practice alone."] },
                { text: "My confidence is really low lately.", options: ["You're more talented than you think.", "Everyone feels that way sometimes.", "Maybe you should quit."] },
                { text: "The center position feels like too much pressure.", options: ["You deserve it. We support you.", "It's definitely tough.", "Then give it to me."] },
                { text: "I messed up during rehearsal...", options: ["It's okay, you can fix it!", "It happens.", "That was embarrassing."] },
                { text: "Do you think the audience likes me?", options: ["They absolutely do!", "Hard to tell.", "Probably not."] },
                { text: "I'm worried about my ranking dropping.", options: ["Rankings don't define your talent.", "It might change.", "Maybe you deserve it."] },
                { text: "My rap part feels too short.", options: ["You still made it shine!", "Yeah, it's short.", "Be grateful you got lines."] },
                { text: "Should I dye my hair for the concept?", options: ["It would look amazing on you!", "If you want.", "That'd look bad."] },
                { text: "I can't hit that dance move cleanly.", options: ["Let's practice it together.", "It's tricky.", "You're too slow."] },
                { text: "The trainers criticized me again.", options: ["That means they see potential in you.", "They can be harsh.", "Maybe you're just not good enough."] },
                { text: "Do you think I suit this cute concept?", options: ["You totally fit it!", "Maybe a little.", "Not at all."] },
                { text: "I miss my family so much.", options: ["They must be so proud of you.", "Yeah... it's hard.", "Focus on the show."] },
                { text: "My stamina is really bad lately.", options: ["Let's work on it together!", "You should train more.", "You're holding us back."] },
                { text: "I'm scared of live stages.", options: ["You'll shine once you're on stage!", "They're intense.", "Then why are you here?"] },
                { text: "Do you think I'm improving?", options: ["So much! I can see it clearly.", "A little.", "Not really."] }
            ]
        },
        vi: {
            paused: "TẠM DỪNG",
            audio_settings: "CÀI ĐẶT ÂM THANH",
            language: "NGÔN NGỮ",
            resume_game: "TIẾP TỤC",
            quit_to_title: "VỀ MENU CHÍNH",
            start_game: "BẮT ĐẦU",
            trainee_profile: "HỒ SƠ THỰC TẬP SINH",
            points: "ĐIỂM",
            name: "TÊN",
            confirm_debut: "XÁC NHẬN DEBUT",
            enter_dorm: "VÀO KÝ TÚC XÁ",
            relations: "MỐI QUAN HỆ",
            settings: "CÀI ĐẶT",
            song_preview: "NGHE THỬ BÀI HÁT",
            song_preview_desc: "NGHE THỬ 5 BÀI HÁT SÂN KHẤU<br>(30 GIÂY)",
            song_preview_next: "TIẾP: CHƠI MINIGAME ĐỂ XẾP THỨ TỰ CHỌN",
            song_selection: "CHỌN BÀI HÁT",
            pick_order_info: "Thứ tự chọn dựa trên xếp hạng Minigame!",
            your_turn_pick: "ĐẾN LƯỢT BẠN CHỌN!",
            team_is_picking: "Đội {name} đang chọn...",
            go_preparation_room: "ĐẾN PHÒNG CHUẨN BỊ",
            play_30s: "NGHE 30S",
            stop: "DỪNG",
            selected_song: "ĐÃ CHỌN: {name}",
            selected_song_len: "ĐÃ CHỌN: {name}<br>(Độ dài: {dur})",
            welcome_day: "CHÀO MỪNG ĐẾN KÝ TÚC XÁ!<br>NGÀY {day}",
            room_team_battle: "ĐẤU ĐỘI",
            room_final_debut: "SÂN KHẤU DEBUT CUỐI",
            prepare_performance: "CHUẨN BỊ BIỂU DIỄN",
            stage_suffix: "SÂN KHẤU",
            no_stamina: "KHÔNG ĐỦ THỂ LỰC! VỀ PHÒNG NGHỈ.",
            rested: "ĐÃ NGHỈ NGƠI!",
            daily_breakdown: "TỔNG KẾT NGÀY",
            minigame_score: "ĐIỂM MINIGAME:",
            event_bonus: "THƯỞNG SỰ KIỆN:",
            livestage_score: "ĐIỂM LIVESTAGE:",
            total_gain: "TỔNG CỘNG:",
            complete_day: "KẾT THÚC NGÀY",
            ranking_board: "BẢNG XẾP HẠNG",
            next_day: "SANG NGÀY MỚI",
            team_battle_results: "KẾT QUẢ ĐẤU ĐỘI",
            continue_to_ranking: "TIẾP TỤC ĐẾN XẾP HẠNG",
            draft_title: "CHỌN ĐỘI",
            draft_status: "CÁC ĐỘI TRƯỞNG ĐANG CHỌN...",
            start_competition: "BẮT ĐẦU COMPETITION",
            random_team_draw: "BỐC TEAM NGẪU NHIÊN",
            go_stage: "VÀO SÂN KHẤU",
            rel_chart: "BẢNG MỐI QUAN HỆ",
            close: "ĐÓNG",
            training: "LUYỆN TẬP",
            exit: "THOÁT",
            result: "KẾT QUẢ",
            try_again: "THỬ LẠI",
            quit: "THOÁT",
            end_livestage: "KẾT THÚC LIVESTAGE",
            failed: "THẤT BẠI",
            quit_get_score: "THOÁT (LẤY ĐIỂM)",
            eliminated: "BỊ LOẠI",
            dont_give_up: "ĐỪNG BỎ CUỘC ƯỚC MƠ!",
            survived: "TRỤ ĐƯỢC:",
            final_rank: "HẠNG CUỐI:",
            total_votes: "TỔNG VOTE:",
            main_menu: "MENU CHÍNH",
            try_again_main: "CHƠI LẠI",
            now_playing: "ĐANG PHÁT",
            select_difficulty: "CHỌN ĐỘ KHÓ:",
            start_stage: "BẮT ĐẦU SÂN KHẤU",
            cancel: "HỦY",
            drafted_song: "BÀI ĐÃ ĐƯỢC CHỌN:",
            apppeal_time: "THỜI GIAN TỎA SÁNG!",
            heart_desc: "HỨNG TIM RƠI ĐỂ NHẬN THÊM VOTE!",
            rotate_device: "VUI LÒNG XOAY MÀN HÌNH",
            bgm_on: "NHẠC NỀN BẬT",
            bgm_off: "NHẠC NỀN TẮT",
            lang_btn_en: "English",
            lang_btn_vi: "Tiếng Việt",
            quit_confirm: "Về menu chính? Tiến trình chưa lưu sẽ mất.",
            click_enable_audio: "BẤM MÀN HÌNH ĐỂ BẬT ÂM THANH",
            missing_music: "THIẾU NHẠC",
            cannot_load_audio: "KHÔNG THỂ TẢI NHẠC LOCAL",
            team_picked: "Đội của bạn đã chọn {name}!",
            error_loading_stage_audio: "LỖI TẢI NHẠC SÂN KHẤU",
            click_continue: "Bấm vào màn hình để tiếp tục...",
            elim_bottom_leave: "LOẠI: NHÓM CUỐI {num} RỜI CUỘC!",
            round_result: "KẾT QUẢ VÒNG {n}",
            team: "ĐỘI",
            perf: "THÀNH TÍCH",
            pts: "ĐIỂM",
            earned: "NHẬN ĐƯỢC",
            next: "TIẾP >>",
            finish: "KẾT THÚC",
            final_standings: "XẾP HẠNG CHUNG CUỘC",
            ranking_bonus: "THƯỞNG XẾP HẠNG",
            complete_event: "HOÀN TẤT SỰ KIỆN",
            survivor: "TRỤ LẠI",
            elim_short: "LOẠI",
            mg_training_prefix: "LUYỆN TẬP",
            mg_vocal_title: "LUYỆN VOCAL",
            mg_dance_title: "LUYỆN DANCE",
            mg_rap_title: "LUYỆN RAP",
            mg_gym_title: "LUYỆN GYM",
            mg_vocal_ins_1: "1. Nhấp chuột trái liên tục để vỗ cánh.",
            mg_vocal_ins_2: "2. Né ống và đừng chạm đất.",
            mg_vocal_ins_3: "3. Sống càng lâu điểm càng cao!",
            mg_dance_ins_1: "1. Quan sát chuỗi phím được tô sáng.",
            mg_dance_ins_2: "2. Nhập lại bằng: D - F - J - K.",
            mg_dance_ins_3: "3. Mỗi vòng chuỗi sẽ dài hơn!",
            mg_rap_ins_1: "1. Đọc từ khóa ở phía trên.",
            mg_rap_ins_2: "2. Gõ chính xác vào ô nhập.",
            mg_rap_ins_3: "3. Gõ nhanh trước khi hết giờ!",
            mg_gym_ins_1: "1. Thanh trắng di chuyển qua lại.",
            mg_gym_ins_2: "2. Nhấn SPACE khi nằm trong vùng xanh.",
            mg_gym_ins_3: "3. Vùng sẽ nhỏ dần và tốc độ tăng lên!",
            mg_ready: "SẴN SÀNG!",
            mg_watch: "QUAN SÁT",
            mg_start: "BẮT ĐẦU!",
            mg_success: "THÀNH CÔNG",
            mg_tap_hint: "CHẠM NÚT hoặc BẤM D-F-J-K",
            fans: "FANS",
            teamwork: "TEAMWORK",
            dialog_like: "đã thích điều đó! (+5 Quan hệ)",
            dialog_dislike: "thất vọng... (-5 Quan hệ)",
            dialog_normal: "Chỉ là một cuộc trò chuyện bình thường.",
            rel_bestie: "BẠN THÂN",
            rel_friend: "BẠN BÈ",
            rel_rival: "ĐỐI THỦ",
            rel_acquaintance: "NGƯỜI QUEN",

            // THƯ VIỆN LỜI THOẠI TIẾNG VIỆT
            dialogues: [
                { text: "Mình rất lo lắng về buổi loại trừ ngày mai...", options: ["Dù thế nào, bạn cũng đã làm hết sức.", "Ừ... đáng sợ thật.", "Nếu bị loại thì đó là lỗi của cậu."] },
                { text: "Bạn thấy nốt cao của mình có vững không?", options: ["Rất tuyệt! Bạn tiến bộ nhiều lắm!", "Cũng tạm ổn.", "Nó bị phô rồi."] },
                { text: "Mình đã thức trắng đêm để tập vũ đạo.", options: ["Tự hào về sự chăm chỉ của bạn!", "Bạn cũng nên nghỉ ngơi đi.", "Đó là vấn đề của cậu."] },
                { text: "Hôm nay ban giám khảo gần như không thèm nhìn mình...", options: ["Họ sẽ sớm chú ý đến bạn thôi, tin mình đi.", "Có thể là vòng sau.", "Có lẽ vì bạn không có gì nổi bật."] },
                { text: "Mình sợ sẽ làm cả đội thất vọng.", options: ["Chúng ta cùng thắng, cùng thua.", "Cứ cố gắng hết sức là được.", "Vậy thì đừng có kéo chân bọn này."] },
                { text: "Tối nay bạn có muốn tập vocal cùng nhau không?", options: ["Tất nhiên rồi! Cùng nhau tiến bộ nhé.", "Để sau đi.", "Tự đi mà tập."] },
                { text: "Dạo này mình tự ti quá.", options: ["Bạn tài năng hơn bạn nghĩ nhiều.", "Đôi khi ai cũng cảm thấy vậy mà.", "Có lẽ cậu nên bỏ cuộc đi."] },
                { text: "Vị trí center áp lực quá.", options: ["Bạn hoàn toàn xứng đáng. Cả đội ủng hộ bạn.", "Công nhận là khó khăn thật.", "Vậy thì nhường cho mình đi."] },
                { text: "Mình làm hỏng lúc tổng duyệt rồi...", options: ["Không sao đâu, bạn có thể sửa mà!", "Chuyện thường thôi.", "Quả đó xấu hổ thật đấy."] },
                { text: "Bạn nghĩ khán giả có thích mình không?", options: ["Chắc chắn là có rồi!", "Khó nói lắm.", "Chắc là không."] },
                { text: "Mình lo thứ hạng sẽ bị tụt.", options: ["Thứ hạng không quyết định tài năng của bạn.", "Nó có thể thay đổi mà.", "Có khi cậu đáng bị vậy đấy."] },
                { text: "Đoạn rap của mình có vẻ hơi ngắn.", options: ["Bạn vẫn khiến nó tỏa sáng mà!", "Ừ, ngắn thật.", "Được chia đoạn là may rồi đấy."] },
                { text: "Mình có nên nhuộm tóc cho hợp concept không?", options: ["Chắc chắn sẽ rất hợp với bạn!", "Tùy cậu thôi.", "Trông sẽ thảm họa lắm."] },
                { text: "Mình không thực hiện sắc nét được động tác nhảy đó.", options: ["Để mình tập cùng bạn nhé.", "Động tác đó khó thật.", "Do cậu chậm chạp quá thôi."] },
                { text: "Các huấn luyện viên lại phê bình mình.", options: ["Điều đó có nghĩa là họ thấy tiềm năng ở bạn.", "Họ khắt khe quá nhỉ.", "Có lẽ do cậu chưa đủ giỏi."] },
                { text: "Bạn nghĩ mình có hợp với concept dễ thương không?", options: ["Cậu cực kỳ hợp luôn!", "Chắc hợp được một chút.", "Không hợp tí nào."] },
                { text: "Mình nhớ gia đình quá.", options: ["Chắc chắn họ rất tự hào về bạn.", "Ừ... khó khăn thật đấy.", "Tập trung vào cuộc thi đi."] },
                { text: "Dạo này thể lực của mình tệ quá.", options: ["Chúng ta cùng nhau rèn luyện nhé!", "Cậu nên tập nhiều hơn.", "Cậu đang kéo lùi cả đội đấy."] },
                { text: "Mình sợ diễn live trên sân khấu quá.", options: ["Lên sân khấu là bạn sẽ tỏa sáng thôi!", "Áp lực thật sự.", "Thế cậu đến thi làm gì?"] },
                { text: "Bạn thấy mình có tiến bộ không?", options: ["Rất nhiều! Mình thấy rõ luôn.", "Một chút xíu.", "Không hẳn."] }
            ]
        }
    },

    t: function (key, params) {
        var table = this.dict[this.current] || this.dict.en;
        var text = table[key] || (this.dict.en[key] || key);
        if (!params) return text;
        return text.replace(/\{(\w+)\}/g, function (_, k) {
            return params[k] !== undefined ? params[k] : "";
        });
    },

    // Hàm lấy thư viện lời thoại (ĐÃ ĐƯỢC LÀM SẠCH VÀ TỐI ƯU)
    getDialogueList: function() {
        var table = this.dict[this.current] || this.dict.en;
        return table.dialogues || this.dict.en.dialogues;
    },

    set: function (lang) {
        this.current = (lang === "vi") ? "vi" : "en";
        localStorage.setItem("game_lang", this.current);
        this.applyStatic();
    },

    toggle: function () {
        this.set(this.current === "en" ? "vi" : "en");
    },

    applyStatic: function () {
        var setText = function (selector, value) {
            var el = document.querySelector(selector);
            if (el) el.textContent = value;
        };
        var setHTML = function (selector, value) {
            var el = document.querySelector(selector);
            if (el) el.innerHTML = value;
        };

        setText("#txt-paused", this.t("paused"));
        if (document.body) document.body.classList.toggle("lang-vi", this.current === "vi");
        setText("#txt-audio-label", this.t("audio_settings"));
        setText("#txt-lang-label", this.t("language"));
        setText("#btn-resume", this.t("resume_game"));
        setText("#btn-quit", this.t("quit_to_title"));
        setText("#btn-change-lang", this.current === "en" ? this.t("lang_btn_vi") : this.t("lang_btn_en"));
        setText("#title-screen button", this.t("start_game"));
        setText("#create-screen h1", this.t("trainee_profile"));
        setText("#create-screen label", this.t("name") + ":");
        setText("#create-screen button[onclick=\"Game.finishCreation()\"]", this.t("confirm_debut"));
        setText("#npc-intro-screen h2", "30 " + this.t("trainee_profile"));
        setText("#npc-intro-screen button", this.t("enter_dorm"));
        setText("#day-summary-screen h1", this.t("daily_breakdown"));
        setText("#day-summary-screen button", this.t("complete_day"));
        var sumLabels = document.querySelectorAll("#day-summary-screen > div > div > span:first-child");
        if (sumLabels[0]) sumLabels[0].textContent = this.t("minigame_score");
        if (sumLabels[1]) sumLabels[1].textContent = this.t("event_bonus");
        if (sumLabels[2]) sumLabels[2].textContent = this.t("livestage_score");
        if (sumLabels[3]) sumLabels[3].textContent = this.t("total_gain");
        setText("#result-screen h1", this.t("ranking_board"));
        setText("#result-screen button", this.t("next_day"));
        setText("#team-reveal-screen h1", this.t("team_battle_results"));
        setText("#btn-reveal-next", this.t("continue_to_ranking"));
        setText("#draft-title", this.t("draft_title"));
        setText("#draft-status", this.t("draft_status"));
        setText("#btn-start-event", this.t("start_competition"));
        setText("#comp-overlay button", (this.current === "vi" ? "SẴN SÀNG?" : "READY?"));
        setText("#team-select-overlay h2", this.t("random_team_draw"));
        setText("#room-notification #stage-setup-area > div > div:first-child", this.t("drafted_song"));
        setText("#room-notification #concept-selector > div:first-child", this.t("select_difficulty"));
        setText("#room-cancel-btn", this.t("cancel"));
        setText("#stage-start-btn", this.t("start_stage"));
        setText("#start-stage-btn", this.t("go_stage"));
        setText("#hub-screen button[onclick=\"Game.showRelList()\"]", "❤ " + this.t("relations"));
        setText("#hub-screen button[onclick=\"Game.toggleSettings()\"]", "☰ " + this.t("settings"));
        setText("#rel-screen h2", this.t("rel_chart"));
        setText("#rel-screen button", this.t("close"));
        setText("#minigame-screen h2", this.t("training"));
        setText("#minigame-screen button[onclick=\"Minigame.exit()\"]", this.t("exit"));
        setText("#mg-res-title", this.t("result"));
        setText("#minigame-result-overlay button[onclick=\"Minigame.retry()\"]", this.t("try_again"));
        setText("#minigame-result-overlay button[onclick=\"Minigame.exit()\"]", this.t("quit"));
        setText("#stage-screen .side-panel button", this.t("end_livestage"));
        setText("#stage-fail-overlay h1", this.t("failed"));
        setText("#stage-fail-overlay button[onclick=\"Stage.retryStage()\"]", this.t("try_again"));
        setText("#stage-fail-overlay button[onclick=\"Stage.quitStage()\"]", this.t("quit_get_score"));
        setText("#game-over-screen h1", this.t("eliminated"));
        setText("#game-over-screen > div:nth-of-type(1)", this.t("dont_give_up"));
        var goLabels = document.querySelectorAll("#game-over-screen .result-box span:first-child");
        if (goLabels[0]) goLabels[0].textContent = this.t("survived");
        if (goLabels[1]) goLabels[1].textContent = this.t("final_rank");
        if (goLabels[2]) goLabels[2].textContent = this.t("total_votes");
        setText("#game-over-screen button", this.t("try_again_main"));
        setText("#win-screen button", this.t("main_menu"));
        setText("#song-draft-overlay .draft-header h1", this.t("song_preview"));
        setHTML("#song-draft-overlay .draft-header p", this.t("song_preview_desc"));
        setText("#btn-to-minigame", this.t("song_preview_next"));
        setText("#rotate-device-overlay p", this.t("rotate_device"));

        if (typeof Game !== "undefined" && Game.updateSettingsUI) {
            Game.updateSettingsUI();
        }
    },

    init: function () {
        var saved = localStorage.getItem("game_lang");
        this.current = saved === "vi" ? "vi" : "en";
        this.applyStatic();
    }
};

window.t = function (key, params) {
    return Lang.t(key, params);
};
